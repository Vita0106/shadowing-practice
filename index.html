<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å½±å­è·Ÿè¯»ç»ƒä¹ </title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 720px;
      margin: auto;
      padding: 20px;
    }
    select, button {
      font-size: 16px;
      margin: 6px 0;
      padding: 6px 10px;
    }
    .text {
      font-size: 20px;
      line-height: 1.8;
      margin: 16px 0;
    }
  </style>
</head>
<body>

<h1>å½±å­è·Ÿè¯»ç»ƒä¹ </h1>

<h3>â‘  é€‰æ‹©ç´ æ</h3>
<select id="materialSelect" onchange="changeMaterial()">
  <option value="0">å’–å•¡å¯¹è¯ï¼ˆåˆçº§ï¼‰</option>
  <option value="1">æ—¥å¸¸é—®å€™ï¼ˆåˆçº§ï¼‰</option>
</select>

<h3>â‘¡ å¬åŸéŸ³</h3>
<audio id="audioPlayer" controls></audio>

<h3>â‘¢ è·Ÿè¯»æ–‡æœ¬</h3>
<button onclick="togglePinyin()">æ‹¼éŸ³</button>
<button onclick="toggleTranslation()">ç¿»è¯‘</button>

<div class="text" id="textDisplay"></div>

<h3>â‘£ å½•éŸ³</h3>
<button onclick="startRecording()">å¼€å§‹å½•éŸ³</button>
<button onclick="stopRecording()">åœæ­¢å¹¶ä¸‹è½½</button>

<p id="status"></p>
<a id="downloadLink"></a>

<script>
const materials = [
  {
    sentences: [
      {
        text: "ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚",
        pinyin: "JÄ«ntiÄn tiÄnqÃ¬ hÄ›n hÇo.",
        translation: "Today's weather is very nice.",
        audio: "coffee_1.mp3"
      },
      {
        text: "æˆ‘ä»¬ä¸€èµ·å»å–å’–å•¡å§ã€‚",
        pinyin: "WÇ’men yÃ¬qÇ qÃ¹ hÄ“ kÄfÄ“i ba.",
        translation: "Let's go have coffee together.",
        audio: "coffee_2.mp3"
      },
      {
        text: "ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ",
        pinyin: "NÇ juÃ©de zÄ›nmeyÃ ng?",
        translation: "What do you think?",
        audio: "coffee_3.mp3"
      }
    ]
  }
];

let showPinyin = false;
let showTranslation = false;

const audio = document.getElementById("audioPlayer");
const textDisplay = document.getElementById("textDisplay");

function changeMaterial() {
  renderSentences(materials[0].sentences);
}

function renderSentences(sentences) {
  textDisplay.innerHTML = "";

  sentences.forEach(sentence => {
    const container = document.createElement("div");
    container.style.marginBottom = "12px";
    container.style.cursor = "pointer";

    const hanzi = document.createElement("div");
    hanzi.innerText = sentence.text;
    hanzi.style.fontSize = "20px";
    hanzi.onclick = () => {
      audio.src = sentence.audio;
      audio.play();
    };

    const pinyin = document.createElement("div");
    pinyin.innerText = sentence.pinyin;
    pinyin.style.color = "#666";
    pinyin.style.display = showPinyin ? "block" : "none";

    const translation = document.createElement("div");
    translation.innerText = sentence.translation;
    translation.style.color = "#999";
    translation.style.display = showTranslation ? "block" : "none";

    container.appendChild(hanzi);
    container.appendChild(pinyin);
    container.appendChild(translation);
    textDisplay.appendChild(container);
  });
}

function togglePinyin() {
  showPinyin = !showPinyin;
  changeMaterial();
}

function toggleTranslation() {
  showTranslation = !showTranslation;
  changeMaterial();
}

changeMaterial();

// ğŸ™ å½•éŸ³é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
let mediaRecorder;
let audioChunks = [];

function startRecording() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();
      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      document.getElementById("status").innerText = "ğŸ™ æ­£åœ¨å½•éŸ³...";
    });
}

function stopRecording() {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    const url = URL.createObjectURL(blob);
    const link = document.getElementById("downloadLink");
    link.href = url;
    link.download = "my-shadowing.webm";
    link.innerText = "â¬‡ï¸ ä¸‹è½½å½•éŸ³";
    document.getElementById("status").innerText = "å½•éŸ³å®Œæˆ";
  };
}
</script>

</body>
</html>
