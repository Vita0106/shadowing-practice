<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>å½±å­è·Ÿè¯»ç»ƒä¹ </title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
  max-width: 860px;
  margin: 40px auto;
  line-height: 1.8;
}

/* æ§åˆ¶æ¡ */
.controls {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 16px;
}

.btn {
  border: 1px solid #ccc;
  background: white;
  padding: 6px 12px;
  border-radius: 10px;
  font-size: 18px;
  cursor: pointer;
}

.btn.active {
  background: #dbeafe;
  border-color: #60a5fa;
}

/* å¥å­ */
.sentence {
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  margin-bottom: 8px;
}

.sentence:hover {
  background: #f3f4f6;
}

.sentence.active {
  background: #dbeafe;
}

.pinyin {
  font-size: 14px;
  color: #666;
  display: none;
}

.trans {
  font-size: 14px;
  color: #999;
  display: none;
}

/* å½•éŸ³ */
#recordStatus {
  color: red;
  font-weight: bold;
  margin-left: 8px;
}

.recordings {
  margin-top: 24px;
}
</style>
</head>

<body>

<h2>å½±å­è·Ÿè¯»ç»ƒä¹ </h2>

<!-- æ§åˆ¶æ¡ -->
<div class="controls">
  <button class="btn" id="playBtn">â–¶ï¸</button>
  <button class="btn" id="pauseBtn">â¸</button>
  <button class="btn" id="loopBtn">ğŸ”</button>
  <button class="btn" id="recordBtn">ğŸ™</button>
  <button class="btn" id="togglePinyin">æ‹¼éŸ³</button>
  <button class="btn" id="toggleTrans">ç¿»è¯‘</button>
  <span id="recordStatus"></span>
</div>

<hr />

<!-- æ–‡æœ¬åŒº -->
<div id="content"></div>

<!-- å½•éŸ³å›å¬ -->
<div class="recordings">
  <h3>ğŸ§ æˆ‘çš„å½•éŸ³</h3>
  <div id="recordList"></div>
</div>

<!-- åŸéŸ³é¢‘ -->
<audio id="audio" src="audio.mp3"></audio>

<script>
/* =====================================================
   â‘  DOM è·å–ï¼ˆéå¸¸é‡è¦ï¼Œå¿…é¡»æœ€å…ˆï¼‰
   ===================================================== */
const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
const loopBtn = document.getElementById("loopBtn");
const recordBtn = document.getElementById("recordBtn");
const togglePinyin = document.getElementById("togglePinyin");
const toggleTrans = document.getElementById("toggleTrans");
const recordStatus = document.getElementById("recordStatus");

const audio = document.getElementById("audio");
const content = document.getElementById("content");
const recordList = document.getElementById("recordList");

/* =====================================================
   â‘¡ å†…å®¹åŒºï¼ˆä½ ä»¥ååªæ”¹è¿™é‡Œï¼‰
   ===================================================== */
const sentences = [
  {
    zh: "ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚",
    pinyin: "JÄ«ntiÄn tiÄnqÃ¬ hÄ›n hÇo.",
    trans: "Today the weather is very nice."
  },
  {
    zh: "æˆ‘ä»¬ä¸€èµ·å»å–å’–å•¡å§ã€‚",
    pinyin: "WÇ’men yÃ¬qÇ qÃ¹ hÄ“ kÄfÄ“i ba.",
    trans: "Let's go have coffee together."
  },
  {
    zh: "ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ",
    pinyin: "NÇ juÃ©de zÄ›nmeyÃ ng?",
    trans: "What do you think?"
  }
];

/* =====================================================
   â‘¢ æ¸²æŸ“æ–‡æœ¬
   ===================================================== */
sentences.forEach((s, i) => {
  const div = document.createElement("div");
  div.className = "sentence";
  div.dataset.index = i;
  div.innerHTML = `
    <div>${s.zh}</div>
    <div class="pinyin">${s.pinyin}</div>
    <div class="trans">${s.trans}</div>
  `;
  content.appendChild(div);
});

/* =====================================================
   â‘£ éŸ³é¢‘åˆ‡å¥ï¼ˆå¹³å‡åˆ†é…æ—¶é—´ï¼‰
   ===================================================== */
let timings = [];
let currentIndex = null;
let loopOn = false;
let stopTimer = null;

audio.addEventListener("loadedmetadata", () => {
  const avg = audio.duration / sentences.length;
  timings = sentences.map((_, i) => ({
    start: i * avg,
    end: (i + 1) * avg
  }));
});

/* =====================================================
   â‘¤ æ’­æ”¾æŸä¸€å¥
   ===================================================== */
function playSentence(i) {
  currentIndex = i;
  const { start, end } = timings[i];

  document.querySelectorAll(".sentence").forEach(s =>
    s.classList.remove("active")
  );
  document.querySelector(`.sentence[data-index="${i}"]`)
    .classList.add("active");

  audio.currentTime = start;
  audio.play();
  playBtn.classList.add("active");

  clearTimeout(stopTimer);
  stopTimer = setTimeout(() => {
    if (loopOn) {
      playSentence(i);
    } else {
      audio.pause();
      playBtn.classList.remove("active");
    }
  }, (end - start) * 1000);
}

document.querySelectorAll(".sentence").forEach(el => {
  el.onclick = () => playSentence(Number(el.dataset.index));
});

/* =====================================================
   â‘¥ æ§åˆ¶æŒ‰é’®
   ===================================================== */
playBtn.onclick = () => {
  if (currentIndex !== null) {
    playSentence(currentIndex);
  } else {
    audio.currentTime = 0;
    audio.play();
    playBtn.classList.add("active");
  }
};

pauseBtn.onclick = () => {
  audio.pause();
  playBtn.classList.remove("active");
};

loopBtn.onclick = () => {
  loopOn = !loopOn;
  loopBtn.classList.toggle("active", loopOn);
};

togglePinyin.onclick = () => {
  document.querySelectorAll(".pinyin").forEach(p => {
    p.style.display = p.style.display === "block" ? "none" : "block";
  });
};

toggleTrans.onclick = () => {
  document.querySelectorAll(".trans").forEach(t => {
    t.style.display = t.style.display === "block" ? "none" : "block";
  });
};

/* =====================================================
   â‘¦ å½•éŸ³ï¼ˆå¯å›å¬ï¼‰
   ===================================================== */
let recorder;
let recording = false;

recordBtn.onclick = async () => {
  if (!recording) {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    recorder.start();

    recording = true;
    recordBtn.classList.add("active");
    recordStatus.innerText = "â— å½•éŸ³ä¸­";

    recorder.ondataavailable = e => {
      const blob = new Blob([e.data], { type: "audio/webm" });
      con
