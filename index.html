<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å½±å­è·Ÿè¯»ç»ƒä¹ </title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 720px;
      margin: auto;
      padding: 20px;
    }
    select, button {
      font-size: 16px;
      margin: 6px 0;
      padding: 6px 10px;
    }
    .text {
      font-size: 20px;
      line-height: 1.8;
      margin: 16px 0;
    }
  </style>
</head>
<body>

<h1>å½±å­è·Ÿè¯»ç»ƒä¹ </h1>

<h3>â‘  é€‰æ‹©ç´ æ</h3>
<select id="materialSelect" onchange="changeMaterial()">
  <option value="0">å’–å•¡å¯¹è¯ï¼ˆåˆçº§ï¼‰</option>
  <option value="1">æ—¥å¸¸é—®å€™ï¼ˆåˆçº§ï¼‰</option>
</select>

<h3>â‘¡ å¬åŸéŸ³</h3>
<audio id="audioPlayer" controls></audio>

<h3>â‘¢ è·Ÿè¯»æ–‡æœ¬</h3>
<div class="text" id="textDisplay"></div>

<h3>â‘£ å½•éŸ³</h3>
<button onclick="startRecording()">å¼€å§‹å½•éŸ³</button>
<button onclick="stopRecording()">åœæ­¢å¹¶ä¸‹è½½</button>

<p id="status"></p>
<a id="downloadLink"></a>

<script>
const materials = [
  {
    sentences: [
      "ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚",
      "æˆ‘ä»¬ä¸€èµ·å»å–å’–å•¡å§ã€‚",
      "ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ"
    ],
    audio: "coffee.mp3"
  }
];

const audio = document.getElementById("audioPlayer");
const textDisplay = document.getElementById("textDisplay");

function changeMaterial() {
  const material = materials[0];
  audio.src = material.audio;
  renderSentences(material.sentences);
}

function renderSentences(sentences) {
  textDisplay.innerHTML = "";
  sentences.forEach((sentence, index) => {
    const p = document.createElement("p");
    p.innerText = sentence;
    p.style.cursor = "pointer";
    p.onclick = () => playSentence(index);
    textDisplay.appendChild(p);
  });
}

// âš ï¸ å…ˆç”¨â€œå‡æ—¶é—´è½´â€ï¼ˆä¸‹ä¸€æ­¥å†ç²¾ç¡®ï¼‰
function playSentence(index) {
  const approxTimes = [0, 3, 7]; // æ¯å¥å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
  audio.currentTime = approxTimes[index];
  audio.play();
}

changeMaterial();

// å½•éŸ³é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
let mediaRecorder;
let audioChunks = [];

function startRecording() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();
      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      document.getElementById("status").innerText = "ğŸ™ æ­£åœ¨å½•éŸ³...";
    });
}

function stopRecording() {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    const url = URL.createObjectURL(blob);
    const link = document.getElementById("downloadLink");
    link.href = url;
    link.download = "my-shadowing.webm";
    link.innerText = "â¬‡ï¸ ä¸‹è½½å½•éŸ³";
    document.getElementById("status").innerText = "å½•éŸ³å®Œæˆ";
  };
}
</script>

</body>
</html>
